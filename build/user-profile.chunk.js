webpackJsonp([5],{14:function(e,t,a){"use strict";function l(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(4),o=l(s);t.default=o.default.createClass({displayName:"MessageBox",render:function(){return""===this.props.message?o.default.createElement("div",null):o.default.createElement("div",{className:"card red"},o.default.createElement("div",{className:"card-content white-text"},this.props.message))}})},402:function(e,t,a){"use strict";function l(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(4),o=l(s),n=(a(39),a(24)),i=l(n),r=a(14),u=l(r);t.default=o.default.createClass({displayName:"UserProfile",getInitialState:function(){return{hasLocal:!1,hasFacebook:!1,hasGoogle:!1,id:"",expectedKcal:"",role:"",profileUrl:"",localFile:"",imagePreviewUrl:"",name:"",email:"",password:"",facebook:"",google:"",status:"EDITING",userCopy:"",message:""}},componentDidMount:function(){var e=this,t="/api/users?userId="+localStorage.getItem("MealAppUserId");i.default.get(t,{headers:{token:localStorage.getItem("MealAppToken")}}).then(function(t){var a=t.data.user;e.setState({userCopy:a}),e.updateUserState(a)}).catch(function(t){return e.setState({message:t.response.status+": "+t.response.data.message})})},updateUserState:function(e){void 0!=e.local.email&&this.setState({hasLocal:!0}),void 0!=e.facebook&&this.setState({hasFacebook:!0}),void 0!=e.google&&this.setState({hasGoogle:!0}),this.setState({id:e._id,expectedKcal:e.expectedKcal,role:e.role,loginFailCount:e.local.loginFailCount}),this.state.hasLocal&&this.setState({name:e.local.name,email:e.local.email}),this.state.hasFacebook&&this.setState({facebook:e.facebook}),this.state.hasGoogle&&this.setState({google:e.google}),null!=e.profilePic&&void 0!=e.profilePic?this.setState({profileUrl:"/api/images?imageId="+e.profilePic}):this.state.hasFacebook?this.setState({profileUrl:e.facebook.profilePicUrl}):this.state.hasGoogle&&this.setState({profileUrl:e.google.profilePicUrl}),console.log(this.state.profileUrl)},handleUserInfoUpdate:function(){var e=this;if(this.state.hasLocal&&""==this.state.name)return void this.setState({message:"Please enter a valid name"});this.setState({status:"LOADING",message:"Saving profile..."});var t="/api/users?userId="+this.state.id,a={name:this.state.name,expectedKcal:this.state.expectedKcal};""!=this.state.password&&(a.password=this.state.password),console.log(a),i.default.put(t,a,{headers:{token:localStorage.getItem("MealAppToken")}}).then(function(t){e.setState({message:t.data.message,password:""}),localStorage.setItem("MealAppExpectedKcal",e.state.expectedKcal),e.setState({status:"EDITING",message:"Record updated"})}).catch(function(t){e.setState({message:t.response.status+": "+t.response.data.message}),e.setState({status:"EDITING",message:""})})},handleReset:function(){this.updateUserState(this.state.userCopy)},handleFileSelect:function(e){e.preventDefault(),this.setState({localFile:e.target.files[0]});var t=new FileReader,a=e.target.files[0];t.addEventListener("load",function(){document.getElementById("profileImg").src=t.result},!1),t.readAsDataURL(a)},handleSubmit:function(e){var t=this;e.preventDefault();var a="/api/images?userId="+this.state.id,l=new FormData;l.append("file",this.state.localFile);var s={headers:{"content-type":"multipart/form-data",token:localStorage.getItem("MealAppToken")}};i.default.post(a,l,s).then(function(e){t.setState({message:e.data.message}),document.getElementById("file").value=""}).catch(function(e){return t.setState({message:e.response.status+": "+e.response.data.message})})},render:function(){var e=this;return o.default.createElement("div",null,o.default.createElement("h3",null,"User profile"),o.default.createElement(u.default,{message:this.state.message}),o.default.createElement("div",null,o.default.createElement("p",null,"User ID: ",this.state.id),o.default.createElement("p",null,"User role: ",this.state.role),o.default.createElement("label",null,"Local name: "),o.default.createElement("input",{className:"localField",type:"text",value:this.state.name,disabled:"EDITING"!=this.state.status||!this.state.hasLocal,onChange:function(t){return e.setState({name:t.target.value})}}),o.default.createElement("br",null),o.default.createElement("label",null,"New password: "),o.default.createElement("input",{className:"localField",type:"password",value:this.state.password,disabled:"EDITING"!=this.state.status||!this.state.hasLocal,onChange:function(t){return e.setState({password:t.target.value})}}),o.default.createElement("br",null),o.default.createElement("label",null,"Planned daily energy intake: "),o.default.createElement("input",{className:"localField",type:"number",value:this.state.expectedKcal,disabled:"EDITING"!=this.state.status,onChange:function(t){return e.setState({expectedKcal:t.target.value})}}),o.default.createElement("br",null)),o.default.createElement("div",{className:"card-green"},o.default.createElement("div",{className:"card-content white-text"},o.default.createElement("p",null,"Facebook ID: ",void 0==this.state.facebook?"N/A":this.state.facebook.id),o.default.createElement("p",null,"Facebook name: ",void 0==this.state.facebook?"N/A":this.state.facebook.name),o.default.createElement("p",null,"Facebook email: ",void 0==this.state.facebook?"N/A":this.state.facebook.email),o.default.createElement("br",null),o.default.createElement("p",null,"Google ID: ",void 0==this.state.google?"N/A":this.state.google.id),o.default.createElement("p",null,"Google name: ",void 0==this.state.google?"N/A":this.state.google.name),o.default.createElement("p",null,"Google email: ",void 0==this.state.google?"N/A":this.state.google.email))),o.default.createElement("input",{type:"button",value:"Save",onClick:this.handleUserInfoUpdate}),o.default.createElement("input",{type:"button",value:"Reset",onClick:this.handleReset}),o.default.createElement("br",null),o.default.createElement("img",{id:"profileImg",src:this.state.profileUrl}),o.default.createElement("form",{onSubmit:this.handleSubmit},o.default.createElement("input",{type:"file",id:"file",accept:"image/jpg",onChange:this.handleFileSelect}),o.default.createElement("input",{type:"submit",value:"Upload profile picture"})))}})}});